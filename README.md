## Trybe Project 37 - Translate

![Tela](src/views/static/images/traduzo.png)

----

<details>
<summary>üßë‚Äçüíª O que dever√° ser desenvolvido</summary>

- Uma ferramenta de tradu√ß√£o de textos entre v√°rios idiomas, utilizando Python com o Framework Flask, para criar uma aplica√ß√£o Server Side. Ou seja, o Back-end ir√° fornecer a camada View, para a pessoa usu√°ria.

</details>

<details>
  <summary>üìù Habilidades a serem trabalhadas </summary>

- Implementar uma API utilizando arquitetura em camadas MVC;
- Utilizar o Docker para projetos Python;
- Aplicar conhecimentos de Orienta√ß√£o a Objetos no desenvolvimento WEB.
- Escrever testes para APIs para garantir a implementa√ß√£o dos endpoints;
- Interagir com um banco de dados n√£o relacional MongoDB;
- Desenvolver p√°ginas web Server Side.

</details>


## Preparando Ambiente

<details>

<summary>üê≥ Subindo a aplica√ß√£o</summary>

**[1]** Crie o ambiente virtual para o projeto

```bash
python3 -m venv .venv && source .venv/bin/activate
```

**[2]** Instale as depend√™ncias

```bash
python3 -m pip install -r dev-requirements.txt
```

**[3 - Op√ß√£o A]** Suba o projeto pelo Docker

```bash
docker compose up translate
```

- Recomendado: Dockerfile e Docker-compose j√° est√£o prontos para uso, para subir o MongoDB e o Flask.

**[3 - Op√ß√£o B]** Caso queira subir somente o banco MongoDB pelo Docker

```bash
docker compose up -d mongodb

python3 src/app.py
```

**[4]** Comece seu desenvolvimento, podendo inclusive j√° acessar a aplica√ß√£o pelo navegador na rota <http://127.0.0.1:8000/> caso utilize a padr√£o do projeto.

- Em primeiro momento, praticamente nada funcionar√°, ent√£o vamos j√° para programa√ß√£o.

**[5]** üí°Dica: O projeto utilizar√° a Pymongo, mas se preocupe pouco com o Mongodb, pois assim como no conte√∫do, voc√™ precisar√° penas herdar a classe abstrata [abstract_model](src/models/abstract_model.py) em sua model, para que tenha acesso aos principais m√©todos de manipula√ß√£o do banco.

**[6]** üí°Dica: Ao rodar a aplica√ß√£o via docker, algumas vari√°veis de ambiente est√£o configuradas. O banco de dados populado ao rodar a aplica√ß√£o localmente ser√° diferente. Se encontrar alguma diverg√™ncia, consulte o arquivo [db.py](src/database/db.py) e certifique-se de que est√° executando os comados no ambiente escolhido, local ou docker.

</details>


## Executando os Testes

<details>
<summary>üõ† Pytest pelo ambiente virtual (Recomendado) </summary>

Por uma melhor integra√ß√£o com o Vscode, e devido o ambiente virtual ser mais leve que um container, ainda √© uma boa recomenda√ß√£o.

**[1]** Crie o ambiente virtual, e instale as depend√™ncias, suba o banco, conforme se√ß√£o preparando ambiente

**[2]** Execute os testes

```bash
python3 -m pytest
```

</details>

<details>
<summary>üó≥Ô∏è Pytest pelo Container Docker </summary>

**[1]** Execute o projeto conforme se√ß√£o preparando ambiente

**[2]** Execute os testes diretamente, ou ap√≥s acessar o sh do container

```bash
docker compose exec -it translate pytest
```

```bash
docker compose exec -it translate sh
```

- Atente-se a realizar um novo Build, sempre que alterar a instala√ß√£o do container.

</details>


## Requisitos

<details>
<summary><b>1 - MODEL - Instanciando idiomas</b></summary>

- Use a classe `LanguageModel` em [language_model.py](src/models/language_model.py)
- `LanguageModel` deve herdar a `AbstractModel` de [abstract_model.py](src/models/abstract_model.py)
- Defina uma cole√ß√£o chamada `languages` para a classe `LanguageModel` atrav√©s de um atributo de classe chamado `_collection`. Voc√™ pode usar como exemplo a implementa√ß√£o em [user_model.py](src/models/user_model.py)
- Crie o m√©todo **init** para a classe chamada `LanguageModel`, ele deve receber um dicion√°rio como argumento que voc√™ deve passar como par√¢metro para o construtor da classe herdada. Ela j√° cuidar√° de persistir em um atributo de inst√¢ncia chamado de `data`.
Exemplo de como o construtor receber√° um dicion√°rio (estilo JSON) como argumento:

```JSON
{"name": "afrikaans", "acronym": "af"}
```

<details>
<summary>O que ser√° testado:</summary>

- Se o m√©todo `save()` da classe `AbstractModel` j√° pode ser utilizado por uma inst√¢ncia da classe ``LanguageModel`` (este m√©todo j√° est√° implementado).
- Se ap√≥s salvar, j√° teremos uma ID do mongoDB, para a `Language`.

</details>

üí° Dica: Com tudo certo at√© aqui, voc√™ pode popular o banco de dados com as `seeds` que j√° est√£o prontas com mais de 130 idiomas, basta executar:

```bash
# caso esteja usando o ambiente virtual local
python3 src/run_seeds.py

# ou, caso esteja rodando a aplica√ß√£o via docker
docker compose exec -it translate python3 src/run_seeds.py
```
</details>

<details>
<summary><b>2 - MODEL - Convers√£o atributo self.data para Dicion√°rio</b></summary>

O retorno padr√£o do MongoDB √© um Objeto Serializado em Bin√°rio (formato conhecido por BSON), seu funcionamento √© pr√≥ximo de um dicion√°rio, por√©m, precisaremos do formato de dicion√°rio para facilitar a futura convers√£o para JSON.

- Implemente o m√©todo `to_dict()` da classe `LanguageModel`. Ele deve retornar um novo dicion√°rio contendo os atributos `name` e `acronym`.
- Os dados para a convers√£o, devem estar dentro da vari√°vel `self.data`.

<details>
<summary>O que ser√° testado:</summary>

- Se uma inst√¢ncia de `LanguageModel`, consegue retornar um dicion√°rio atrav√©s do m√©todo `to_dict()`.

</details>

</details>

<details>
<summary><b>3 - MODEL -  Listagem de Idiomas como Dicion√°rios</b></summary>

Retornaremos todos os idiomas como uma lista iter√°vel.

- Implemente o m√©todo de classe `list_dicts()` para a classe `LanguageModel`.
- O m√©todo `list_dicts()` deve buscar atrav√©s de um `find()` todas os idiomas cadastrados.
- Converta cada idioma do retorno para um dicion√°rio e adicione em uma lista, que dever√° ser o retorno final do m√©todo.

<details>
    <summary>O que ser√° testado:</summary>

- Que √© poss√≠vel acessar o m√©todo `list_dicts()` atrav√©s da nota√ß√£o `LanguageModel.list_dicts()`;
- O retorno dever√° ser a lista com todos os idiomas cadastrados.

</details>

</details>


<details>
<summary><b>4 - CONTROLLER & VIEW -  Endpoint Tradutor, renderizando vari√°veis do Back-end - GET</b></summary>

Para renderizar vari√°veis em uma template, o Back-end (Controller) deve as enviar como par√¢metros do m√©todo `render_template`. Os par√¢metros que devem ser inclu√≠dos s√£o:

- languages: Todos os idiomas dispon√≠veis, que devem ser obtidos utilizando o m√©todo `LanguageModel.find()`;
- text_to_translate: A string "O que deseja traduzir?";
- translate_from: O acr√¥nimo do idioma de origem da tradu√ß√£o, padronizado como `pt`;
- translate_to: O acr√¥nimo do idioma de destino da tradu√ß√£o, padronizado como `en`;
- translated: A string "What do you want to translate?".

O valor de `text_to_translate` deve ser inserido no `input` de origem, e o valor de `translated` deve ser inserido no `input` de destino.

Para este requisito, implemente a fun√ß√£o `index()` que j√° existe no arquivo `src/controllers/translate_controller.py`. Essa fun√ß√£o j√° possui uma implementa√ß√£o b√°sica para a rota `/`.

Al√©m disso, ser√° tamb√©m necess√°rio atualizar o *template* `src/views/templates/index.html` com as vari√°veis do Back-end. Os nomes das linguagens devem aparecer em mai√∫sculo no template.

- Adicione as vari√°veis no Front-end, dando sentido √† navega√ß√£o. Por exemplo, todos os idiomas devem ser inseridos como `Options` no `select` que est√° vazio.

```html
   <select name="translate-from">
   </select>
```

- Voc√™ tamb√©m precisa implementar a l√≥gica no template para adicionar a flag `selected`, no idioma que equivaler ao acr√¥nimo que o Back-end enviou.

üí° Dica: `Jinja2` permite criar um `if`, de dentro da declara√ß√£o de uma <option ...if...> </option>

<details>
<summary>O que ser√° testado:</summary>

- A p√°gina deve exibir o texto "O que deseja traduzir?" no input de origem.
- A p√°gina deve exibir a palavra "What do you want to translate?" no input de destino.
- A p√°gina deve exibir todas as op√ß√µes de idioma, no Select Options do template onde cada op√ß√£o corresponde a um idioma existente no sistema.
- As op√ß√µes de idioma devem estar todas em letras mai√∫sculas.

</details>
</details>


<details>
<summary><b>5 - CONTROLLER - Tradu√ß√£o de Texto - POST</b></summary>

Chegou a hora de traduzir o texto, para isso, a rota POST `/` deve receber os seguintes par√¢metros no corpo da solicita√ß√£o:

- `text_to_translate`: Uma string contendo o texto a ser traduzido;
- `translate_from`: Uma string contendo o idioma de origem do texto;
- `translate_to`: Uma string contendo o idioma de destino da tradu√ß√£o;

  Ao receber a solicita√ß√£o, voc√™ deve realizar a tradu√ß√£o do texto usando os idiomas e a l√≥gica de tradu√ß√£o adequados.

  üí° Dica: use o objeto `request` para conseguir resgatar os par√¢metros enviados na solicita√ß√£o. Lembre-se que as chaves dos par√¢metros s√£o definidas de acordo com o atributo `name` dos elementos HTML.

<details>
  <summary>O que ser√° testado:</summary>

- Se ao enviar `text_to_translate` como "Hello, I like videogame", `translated` ser√° "Ol√°, eu gosto de videogame".
- Se na requisi√ß√£o, `translate_from` est√° selecionado `en` e se `translate_to` est√° selecionado `pt`.

</details>

üí° Dica: A biblioteca da API do `GoogleTranslator` j√° est√° instalada. O arquivo `example.py`, na raiz do projeto, possui um c√≥digo de exemplo e voc√™ pode usar para compreender seu funcionamento. Para isso, execute `python3 example.py`.

üí° Dica 2: N√£o temos hist√≥rico da API do `GoogleTranslator` parar de funcionar, mas, caso ocorra, voc√™ pode optar pela estrat√©gia de traduzir manualmente *strings* pr√© definidas por voc√™ e pelo teste, para seguir normalmente com o desenvolvimento.

</details>

<details>
<summary><b>6 - CONTROLLER - Tradu√ß√£o Reversa - POST</b></summary>

Se voc√™ acessou a aplica√ß√£o, deve ter visto no Front-end um bot√£o para inverter a linguagem. Vamos implementar sua funcionalidade agora.

- Implemente a fun√ß√£o `reverse()` que ser√° respons√°vel por uma nova rota chamada `/reverse` com o m√©todo POST. Ela deve renderizar o mesmo template (`index.html`) e tamb√©m deve receber os mesmos par√¢metros que a rota principal:
  - `text_to_translate`: Uma string contendo o texto a ser traduzido.
  - `translate_from`: Uma string contendo o idioma de origem do texto.
  - `translate_to`: Uma string contendo o idioma de destino da tradu√ß√£o.

- Fa√ßa a tradu√ß√£o assim como na rota principal, por√©m, com uma diferen√ßa: Ao renderizar o template, voc√™ dever√° inverter os idiomas de origem `translate_from` e destino `translate_to` e tamb√©m inverter o texto traduzido `translated` e o texto original `text_to_translate`.

N√£o se esque√ßa que, sempre que renderizar novamente o template, passar os seguintes par√¢metros:

- languages: A lista de idiomas existentes, obtidos usando o m√©todo `LanguageModel.find()`;
- text_to_translate: O texto traduzido;
- translated: O texto original antes da tradu√ß√£o;
- translate_from: O idioma de destino;
- translate_to: O idioma de origem.

<details>
  <summary>O que ser√° testado:</summary>

- Se ao enviar `text_to_translate` como "Hello, I like videogame", `translated` ficar√° com texto "Hello, I like videogame" e `text_to_translate` passa a ser sua tradu√ß√£o "Ol√°, eu gosto de videogame".
- Se na requisi√ß√£o, `translate_from` est√° selecionado `pt` e se `translate_to` est√° selecionado `en`.


</details>
</details>


<details>
<summary><b>7 - TESTE - Hist√≥rico de Tradu√ß√µes</b></summary>

Em dias atuais, analisar dados pode gerar muitos aprendizados. Por hora, vamos armazenar o hist√≥rico de tradu√ß√µes.

A classe `HistoryModel`, j√° foi implementada pela equipe inicial, por√©m foi utilizada uma classe auxiliar `BSONToJSON`, que n√£o deixou o time t√£o confiante, principalmente porque foi criada sem testes. Nossa miss√£o aqui ser√° criar um teste para verificar se o m√©todo `list_as_json()` funciona adequadamente. Este m√©todo √© respons√°vel por retornar um JSON que cont√©m os hist√≥ricos salvos.

- Crie o teste no arquivo `tests/models/history/test_history_model.py`
- Carregue no teste os JSONs de `HistoryModel.list_as_json()`
- Confira se o conte√∫do do JSON apresenta o conte√∫do da fixture `prepare_base()`, implementada em `tests/models/history/conftest.py`.

üí° Dica: Lembre que para carregar os dados de um JSON em Python √© poss√≠vel usar a biblioteca `JSON`.

<details>
  <summary>O que ser√° testado:</summary>

- Aqui entram os testes de seu teste, que ser√£o executados pelo arquivo `tests/models/history/test_to_test_history_model.py`. Este arquivo **N√ÉO** dever√° ser alterado.

</details>
</details>

<details>
<summary><b>8 - Endpoint de Listagem de Hist√≥rico de Tradu√ß√µes - API GET</b></summary>

O objetivo aqui √© criar um *endpoint* que permita a listagem dos registros de hist√≥rico de tradu√ß√µes.

- Crie um novo arquivo para a *controller* do *endpoint*, use as controllers j√° implementadas como refer√™ncia.
- A nova *controller* responder√° a um `GET` em `http://localhost:8000/history`.
- Registre a `Blueprint` da controller no `app.py`.
- Ao receber uma requisi√ß√£o `GET` na rota, o *endpoint* deve retornar os registros de hist√≥rico de tradu√ß√µes em formato JSON.
- O *endpoint* deve retornar uma resposta HTTP com status `200 (OK)` e o conte√∫do JSON contendo os registros de hist√≥rico.
- Garanta que ao realizar uma tradu√ß√£o na rota `POST` `http://localhost:8000/` (`src/controllers/translate_controller.py`), tamb√©m seja criado o hist√≥rico.

</details>
</details>

<details>
<summary><b>9 - TESTE - Exclus√£o de Hist√≥rico de Tradu√ß√µes - DELETE</b></summary>

Ser√° preciso fornecer a equipe de administra√ß√£o do sistema a possibilidade de excluir um hist√≥rico por meio do endpoint `DELETE` na rota `/admin/history/<id>`. Esse endpoint necessita de um token que ir√° autorizar a requisi√ß√£o.

O c√≥digo desta funcionalidade j√° foi implementado em [src/controllers/admin_controller.py](src/controllers/admin_controller.py), por√©m, para esta tarefa ser considerada como conclu√≠da, ser√° necess√°rio que esse c√≥digo seja testado.

- Crie um teste automatizado para verificar a funcionalidade de exclus√£o do hist√≥rico de tradu√ß√µes.
- O teste deve ser escrito em `tests/controllers/admin/test_admin_controller.py`.
- O teste `test_history_delete` deve simular a exclus√£o de um registro espec√≠fico do hist√≥rico e verificar se subtraiu um da base de dados usada.
- Voc√™ precisar√° salvar no banco um objeto `UserModel` para a autentica√ß√£o e objetos `HistoryModel` para testar a exclus√£o.
- `app_test` √© uma fixture definida no `conftest.py`. Voc√™ pode us√°-la no teste, para chamar a requisi√ß√£o delete.
- 

Veja um exemplo de como passar um header para uma requisi√ß√£o:

```python
 app_test.delete(f"/admin/history/{id}", headers={
      "Authorization": "um token",
      "User": "um nome",
  })
```

üí° Dica: Para compreender a cria√ß√£o de um `user` e a gera√ß√£o de seu token, veja a implementa√ß√£o do arquivo `src/models/user_model.py`.

----
</details>
</details>

